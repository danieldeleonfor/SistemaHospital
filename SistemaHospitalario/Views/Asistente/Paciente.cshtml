@model SistemaHospitalario.Models.Paciente

<div class="row">
    <div class="col-sm-12">
        <button class="btn waves-effect waves-light btn-inverse"><i class="icofont icofont-exchange"></i>Pacientes Registrados</button>
        <br />
        <br />
        <div class="card">
            <div class="card-header">
                <h5>Registro de Pacientes</h5>
                <!--<span>Add class of <code>.form-control</code> with <code>&lt;input&gt;</code> tag</span>-->
            </div>
            <div class="card-block">
                <form method="post" asp-controller="Asistente" asp-action="Paciente" class="form-material">
                    <div class="form-group form-default form-static-label">
                        <input asp-for="@Model.Cedula" type="text" name="footer-email" class="form-control" placeholder="Ingrese la Cedula" required="">
                        <span class="form-bar"></span>
                        <label class="float-label">Cedula</label>
                    </div>
                    <div class="form-group form-default form-static-label">
                        <input asp-for="Nombre" type="text" name="footer-email" class="form-control" placeholder="Ingrese los nombre" disabled required="">
                        <span class="form-bar"></span>
                        <label class="float-label">Nombre</label>
                    </div>
                    <div class="form-group form-default form-static-label">
                        <input asp-for="Apellido" type="text" name="footer-email" class="form-control" placeholder="Ingrese los apellido" disabled required="">
                        <span class="form-bar"></span>
                        <label class="float-label">Apellido</label>
                    </div>
                    <div class="form-group form-default form-static-label">
                        <input asp-for="FechaNacimiento" type="date" name="footer-email" class="form-control" disabled>
                        <span class="form-bar"></span>
                        <label class="float-label">Fecha Nacimiento</label>
                    </div>
                    <div class="form-group form-default form-static-label">
                        <input asp-for="TipoSangre" type="text" name="footer-email" class="form-control" placeholder="Ingrese el tipo de sangre" disabled required="">
                        <span class="form-bar"></span>
                        <label class="float-label">Tipo Sangre</label>
                    </div>
                    <button name="footer-email" disabled class="btn waves-effect waves-light btn-success"><i class="icofont icofont-check-circled"></i>Registrar Paciente</button>
                </form>
            </div>
        </div>
    </div>
</div>
@section script
{
    <script>
        $(document).ready(
            function () {
                var cedulatxt = document.getElementById('Cedula');
                $(cedulatxt).on('input', function () {
                    cedulaTBTextControl(cedulatxt);
                    if ($(cedulatxt).val().length > 12) {
                        console.log('paso');
                        var noCedula = $(cedulatxt).val();
                        $.post("/Asistente/VerificarCedulaPaciente", { 'cedula': $(cedulatxt).val() }, function (result) {
                            if (result == true) {
                                UnlockFieldsByCedula();
                            }
                        });
                    }
                });
                function UnlockFieldsByCedula() {
                    var allFields = $("input[name=footer-email]");
                    var button = $("button[name=footer-email]");

                    $(button).prop('disabled', false);
                    $(allFields).each(function () { 
                        $(this).prop('disabled', false);
                    })
                    $(cedulatxt).prop('disabled', true);
                    
                }
                function lockFieldsByCedula() {
                    var allFields = $("input[name=footer-email]");
                    $(allFields).each(function () {
                        $(this).prop('disabled', true);
                    })
                    $(cedulatxt).prop('disabled', false);
                }
                function cedulaTBTextControl(textbox) {
                    var text = $(textbox).val();
                    var result = "";
                    var len = text.length;

                    if (len > 11 && text[11] != '-') {
                        var parteIzquierda = text.substring(0, 11);
                        var parteDerecha = text.substring(11, 12);
                        result = parteIzquierda + "-" + parteDerecha;
                    }
                    else {
                        result = text;
                    }

                    if (len > 3 && text[3] != '-') {
                        var parteIzquierda = result.substring(0, 3);
                        var parteDerecha = result.substring(3, len);
                        result = parteIzquierda + "-" + parteDerecha;
                    }

                    if (result.length > 13) {
                        result = result.substring(0, 14);

                    }
                    $(textbox).val(result);

                    
                    
                }
            }
        )
    </script>
}